<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Razorpay Payment Test</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body>

    <h2>Razorpay Payment Integration</h2>
    <p>Click the button below to make a test payment.</p>
    <button id="pay-btn">Pay Now</button>

    <script>
        document.getElementById("pay-btn").addEventListener("click", async function () {
            try {
                const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MjEsImVtYWlsIjoid2FxYXJAYWxlbmRlaS5jb20iLCJjdXJyZW50V29ya3NwYWNlSWQiOiI5NjM0YjBjYS0zZTFjLTQ2NjAtYTgxMy01ZDk4MmJiNWE3M2EiLCJpYXQiOjE3NDg0MjE4NjksImV4cCI6MTc0OTAyNjY2OX0.oq2aHhta-4f4KKB9BWebkgIVQMzqjxVlvvlE6V_PJCY";
                // 1️⃣ Create an order on the backend
                const orderResponse = await fetch("http://localhost:3002/api/payment/create-order", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    body: JSON.stringify({ amount: 500 }) // Amount in INR
                });

                const orderData = await orderResponse.json();
                console.log("Order Created:", orderData);

                if (!orderData.id) {
                    alert("Failed to create order. Check backend logs.");
                    return;
                }

                // 2️⃣ Initialize Razorpay Checkout
                var options = {
                    key: "rzp_test_r44pa7uc4dQP38", // Replace with actual Key ID
                    amount: orderData.amount, // Amount in paisa
                    currency: "INR",
                    name: "My Business",
                    description: "Test Transaction",
                    order_id: orderData.id, // Razorpay Order ID from backend
                    handler: async function (response) {
                        console.log("Payment Successful:", response);

                        // 3️⃣ Verify the payment with the backend
                        const verifyResponse = await fetch("http://localhost:3002/api/payment/verify-payment", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                "Authorization": `Bearer ${token}`
                            },
                            body: JSON.stringify({
                                razorpay_order_id: response.razorpay_order_id,
                                razorpay_payment_id: response.razorpay_payment_id,
                                razorpay_signature: response.razorpay_signature
                            })
                        });

                        const verifyData = await verifyResponse.json();
                        console.log("Payment Verification Response:", verifyData);

                        if (verifyData.success) {
                            alert("✅ Payment Verified Successfully!");
                        } else {
                            alert("❌ Payment Verification Failed!");
                        }
                    },
                    theme: { color: "#3399cc" }
                };

                var rzp = new Razorpay(options);
                rzp.open();
            } catch (error) {
                console.error("Error:", error);
                alert("Something went wrong. Check console logs.");
            }
        });
    </script>

</body>

</html>